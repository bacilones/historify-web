"use strict";!function(){angular.module("historify",["historify.core"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state({name:"home",url:"/home",templateUrl:"./templates/home.html",controller:"HomeController"}),e.state({name:"home.map",url:"/map",templateUrl:"./templates/map.html",controller:"MapController"}),t.otherwise("/home/map")}]).controller("MapController",["$scope","$http","$uibModal",function(e,t,o){function l(t,o){var l=document.createElement("div");l.style.backgroundColor="#45a2d1",l.style.border="2px solid #45a2d1",l.style.borderRadius="50px",l.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",l.style.cursor="pointer",l.style.marginTop="100px",l.title="Click to recenter the map",t.appendChild(l);var a=document.createElement("div");a.style.color="rgb(25,25,25)",a.style.fontFamily="Roboto,Arial,sans-serif",a.style.fontSize="30px",a.style.color="#ffffff",a.style.lineHeight="38px",a.style.paddingLeft="10px",a.style.paddingRight="10px",a.innerHTML="+",l.appendChild(a),l.addEventListener("click",function(){e.addNewEventModal()})}e.addNewEventModal=function(){o.open({animation:!0,templateUrl:"./templates/addEvent.html",controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],size:"sm",backdrop:!0,keyboard:!0})},e.addNewPointOfViewModal=function(){},e.markers=[],e.labels=[],e.removeAllMarkers=function(){e.markers.forEach(function(e){e.setMap(null)}),e.markers=[]},e.removeAllLabels=function(){e.labels.forEach(function(e){e.setMap(null)}),e.labels=[]},e.map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-33.434678,lng:-70.63578},styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]});var a=document.createElement("div");new l(a,map);a.index=1,console.log("styleee",google.maps.ControlPosition.RIGHT_TOP),e.map.controls[1].push(a);var r={method:"GET",url:"http://api.historify.cl/historicalevent",params:{}};t(r).then(function(o){o.data.forEach(function(o){var l=new google.maps.Marker({position:{lat:parseFloat(o.lat),lng:parseFloat(o.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),a=new MapLabel({text:o.name,position:new google.maps.LatLng(o.lat,o.long),map:e.map,fontSize:15,fontColor:"#ffffff",strokeWeight:0,align:"center"});l.addListener("click",function(){console.log("marker presed",o.id);var l={method:"GET",url:"http://api.historify.cl/historicalevent/"+o.id};t(l).then(function(t){e.removeAllMarkers(),e.removeAllLabels(),t.data.point_of_views.forEach(function(t){var o=new google.maps.Marker({position:{lat:parseFloat(t.lat),lng:parseFloat(t.long)},map:e.map,icon:"./resources/img/point_of_view.png"}),l=new MapLabel({text:t.title,position:new google.maps.LatLng(t.lat,t.long),map:e.map,fontSize:15,fontColor:"#ffffff",strokeWeight:0,align:"center"}),a=new google.maps.InfoWindow({content:t.content});o.addListener("click",function(){a.open(e.map,o)}),e.labels.push(l),e.markers.push(o)});new google.maps.Marker({position:{lat:parseFloat(t.data.lat),lng:parseFloat(t.data.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),new MapLabel({text:t.data.name,position:new google.maps.LatLng(t.data.lat,t.data.long),map:e.map,fontSize:15,fontColor:"#ffffff",strokeWeight:0,align:"center"});e.map.setZoom(13)}).catch(function(e){console.log(e)})}),e.markers.push(l),e.labels.push(a)}),console.log("markers -->",e.markers)}).catch(function(e){console.log(e)})}]).controller("HomeController",["$scope",function(e){console.log("home")}])}();