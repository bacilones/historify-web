"use strict";!function(){angular.module("historify",["historify.core"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state({name:"home",url:"/home",templateUrl:"./templates/home.html",controller:"HomeController"}),e.state({name:"home.map",url:"/map",templateUrl:"./templates/map.html",controller:"MapController"}),o.otherwise("/home/map")}]).controller("MapController",["$scope","$http","$uibModal",function(e,o,t){function a(o,t){var a=document.createElement("div");a.style.backgroundColor="#6fcb9f",a.style.border="2px solid #6fcb9f",a.style.borderRadius="50px",a.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",a.style.cursor="pointer",a.style.marginTop="100px",console.log(a.style),a.style.alignSelf="right",a.title="Click to recenter the map",o.appendChild(a);var n=document.createElement("div");n.style.color="rgb(25,25,25)",n.style.fontFamily="Roboto,Arial,sans-serif",n.style.fontSize="35px",n.style.lineHeight="38px",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.innerHTML="+",a.appendChild(n),a.addEventListener("click",function(){e.addNewEventModal()})}e.addNewEventModal=function(){t.open({animation:!0,templateUrl:"./templates/addEvent.html",controller:["$scope","$uibModalInstance",function(e,o){e.cancel=function(){o.close()}}],size:"sm",backdrop:!0,keyboard:!0})},e.addNewPointOfViewModal=function(){},e.markers=[],e.labels=[],e.removeAllMarkers=function(){e.markers.forEach(function(e){e.setMap(null)}),e.markers=[]},e.removeAllLabels=function(){e.labels.forEach(function(e){e.setMap(null)}),e.labels=[]},e.map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-33.434678,lng:-70.63578}});var n=document.createElement("div");new a(n,map);n.index=1,e.map.controls[google.maps.ControlPosition.TOP_CENTER].push(n);var l={method:"GET",url:"http://api.historify.cl/historicalevent",params:{}};o(l).then(function(t){t.data.forEach(function(t){var a=new google.maps.Marker({position:{lat:parseFloat(t.lat),lng:parseFloat(t.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),n=new MapLabel({text:t.name,position:new google.maps.LatLng(t.lat,t.long),map:e.map,fontSize:15,fontColor:"#232324",strokeWeight:2,align:"center"});a.addListener("click",function(){console.log("marker presed",t.id);var a={method:"GET",url:"http://api.historify.cl/historicalevent/"+t.id};o(a).then(function(o){e.removeAllMarkers(),e.removeAllLabels(),o.data.point_of_views.forEach(function(o){var t=new google.maps.Marker({position:{lat:parseFloat(o.lat),lng:parseFloat(o.long)},map:e.map,icon:"./resources/img/point_of_view.png"}),a=new MapLabel({text:o.title,position:new google.maps.LatLng(o.lat,o.long),map:e.map,fontSize:15,fontColor:"#232324",strokeWeight:2,align:"center"}),n=new google.maps.InfoWindow({content:o.content});t.addListener("click",function(){n.open(e.map,t)}),e.labels.push(a),e.markers.push(t)});new google.maps.Marker({position:{lat:parseFloat(o.data.lat),lng:parseFloat(o.data.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),new MapLabel({text:o.data.name,position:new google.maps.LatLng(o.data.lat,o.data.long),map:e.map,fontSize:15,fontColor:"#232324",strokeWeight:2,align:"center"});e.map.setZoom(13)}).catch(function(e){console.log(e)})}),e.markers.push(a),e.labels.push(n)}),console.log("markers -->",e.markers)}).catch(function(e){console.log(e)})}]).controller("HomeController",["$scope",function(e){console.log("home")}])}();