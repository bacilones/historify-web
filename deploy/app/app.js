"use strict";!function(){angular.module("historify",["historify.core"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state({name:"home",url:"/home",templateUrl:"./templates/home.html",controller:"HomeController"}),e.state({name:"home.map",url:"/map",templateUrl:"./templates/map.html",controller:"MapController"}),t.otherwise("/home/map")}]).controller("MapController",["$scope","$http","$uibModal","$rootScope",function(e,t,o,a){function l(t,o){var a=document.createElement("div");a.style.backgroundColor="#fff",a.style.border="2px solid #fff",a.style.borderRadius="3px",a.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",a.style.cursor="pointer",a.style.marginTop="100px",a.style.textAlign="center",a.title="Click to recenter the map",t.appendChild(a);var l=document.createElement("div");l.style.color="rgb(25,25,25)",l.style.fontFamily="Roboto,Arial,sans-serif",l.style.fontSize="16px",l.style.lineHeight="38px",l.style.paddingLeft="5px",l.style.paddingRight="5px",l.innerHTML="← Back",a.appendChild(l),a.addEventListener("click",function(){e.map.controls[1].clear(),e.map.setZoom(15),e.removeAllLabels(),e.removeAllMarkers(),e.loadMarkers()})}e.markers=[],e.labels=[],e.isInPovView=!1,a.map=e.map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-33.434678,lng:-70.63578},styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]}),e.addNewEventModal=function(e){o.open({animation:!0,templateUrl:"./templates/addEvent.html",controller:["$scope","$uibModalInstance","position","$http",function(e,t,o,n){e.newEvent={},e.newEvent.lat=o.lat(),e.newEvent.long=o.lng(),e.newEvent.user_id=1,e.newEvent.large_description="",e.createEvent=function(){var r={method:"POST",url:"http://api.historify.cl/historicalevent",params:e.newEvent};n.post(r.url,e.newEvent).then(function(r){var s=new google.maps.Marker({position:o,map:e.map,icon:"./resources/img/historical_event_marker.png"});new MapLabel({text:r.data.name,position:new google.maps.LatLng(r.data.lat,r.data.long),map:a.map,fontSize:15,fontColor:"#ffffff",fontFamily:"Raleway, sans-serif",strokeWeight:0,align:"center"});s.addListener("click",function(){var t=document.createElement("div");new l(t,map);t.index=1,e.map.controls[1].push(t);var o={method:"GET",url:"http://api.historify.cl/historicalevent/"+r.data.id};n(o).then(function(t){e.removeAllMarkers(),e.removeAllLabels(),t.data.point_of_views.forEach(function(t){var o=new google.maps.Marker({position:{lat:parseFloat(t.lat),lng:parseFloat(t.long)},map:e.map,icon:"./resources/img/point_of_view.png"}),a=new MapLabel({text:t.title,position:new google.maps.LatLng(t.lat,t.long),map:e.map,fontSize:15,fontColor:"#ffffff",fontFamily:"Raleway, sans-serif",strokeWeight:0,align:"center"}),l=new google.maps.InfoWindow({content:t.content});o.addListener("click",function(){l.open(e.map,o)}),e.labels.push(a),e.markers.push(o)});new google.maps.Marker({position:{lat:parseFloat(t.data.lat),lng:parseFloat(t.data.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),new MapLabel({text:t.data.name,position:new google.maps.LatLng(t.data.lat,t.data.long),map:e.map,fontSize:15,fontColor:"#ffffff",fontFamily:"Raleway, sans-serif",strokeWeight:0,align:"center"});e.map.setZoom(13)}).catch(function(e){console.log(e)})}),t.close()}).catch(function(e){console.log(e)})},e.cancel=function(){t.close()}}],size:"sm",backdrop:!0,keyboard:!0,resolve:{position:e}})},e.addNewPointOfViewModal=function(){},a.removeAllLabels=e.removeAllMarkers=function(){e.markers.forEach(function(e){e.setMap(null)}),e.markers=[]},a.removeAllMarkers=e.removeAllLabels=function(){e.labels.forEach(function(e){e.setMap(null)}),e.labels=[]},e.map.addListener("click",function(t){e.map.panTo(t.latLng),e.addNewEventModal(t.latLng)});var n={method:"GET",url:"http://api.historify.cl/historicalevent",params:{}};e.loadMarkers=function(){t(n).then(function(o){o.data.forEach(function(o){var a=new google.maps.Marker({position:{lat:parseFloat(o.lat),lng:parseFloat(o.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),n=new MapLabel({text:o.name,position:new google.maps.LatLng(o.lat,o.long),map:e.map,fontSize:15,fontColor:"#ffffff",fontFamily:"Raleway, sans-serif",strokeWeight:0,align:"center"});a.addListener("click",function(){e.isInPovView=!0;var a=document.createElement("div");new l(a,map);a.index=1,e.map.controls[1].push(a);var n={method:"GET",url:"http://api.historify.cl/historicalevent/"+o.id};t(n).then(function(t){e.removeAllMarkers(),e.removeAllLabels(),t.data.point_of_views.forEach(function(t){var o=new google.maps.Marker({position:{lat:parseFloat(t.lat),lng:parseFloat(t.long)},map:e.map,icon:"./resources/img/point_of_view.png"}),a=new MapLabel({text:t.title,position:new google.maps.LatLng(t.lat,t.long),map:e.map,fontSize:15,fontColor:"#ffffff",fontFamily:"Raleway, sans-serif",strokeWeight:0,align:"center"}),l=new google.maps.InfoWindow({content:t.content});o.addListener("click",function(){l.open(e.map,o)}),e.labels.push(a),e.markers.push(o)});new google.maps.Marker({position:{lat:parseFloat(t.data.lat),lng:parseFloat(t.data.long)},map:e.map,icon:"./resources/img/historical_event_marker.png"}),new MapLabel({text:t.data.name,position:new google.maps.LatLng(t.data.lat,t.data.long),map:e.map,fontSize:15,fontColor:"#ffffff",strokeWeight:0,fontFamily:"Raleway, sans-serif",align:"center"});e.map.setZoom(13)}).catch(function(e){console.log(e)})}),e.markers.push(a),e.labels.push(n)}),console.log("markers -->",e.markers)}).catch(function(e){console.log(e)})},e.loadMarkers()}]).controller("HomeController",["$scope",function(e){console.log("home")}])}();